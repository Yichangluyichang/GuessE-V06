<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šä¼ é»˜è®¤çš‡å¸æ•°æ®åˆ°äº‘ç«¯</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .info-box p {
            margin: 0.5rem 0;
            color: #1976d2;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        button {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 8px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        
        .progress {
            margin-top: 1rem;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e6ed;
            border-radius: 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¤ ä¸Šä¼ 50ä¸ªçš‡å¸æ•°æ®åˆ°äº‘ç«¯</h1>
        
        <div class="info-box">
            <p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
            <p>â€¢ è¿™ä¸ªå·¥å…·ä¼šè¯»å– default-emperors-data.js ä¸­çš„50ä¸ªçš‡å¸æ•°æ®</p>
            <p>â€¢ ç„¶åæ‰¹é‡ä¸Šä¼ åˆ° Firebase äº‘ç«¯</p>
            <p>â€¢ ä¸Šä¼ åï¼Œæ‰€æœ‰è®¾å¤‡éƒ½èƒ½çœ‹åˆ°è¿™äº›æ•°æ®</p>
        </div>
        
        <div class="form-group">
            <label for="admin-email">ç®¡ç†å‘˜é‚®ç®±</label>
            <input type="email" id="admin-email" placeholder="è¾“å…¥ä½ åœ¨ Firebase åˆ›å»ºçš„ç®¡ç†å‘˜é‚®ç®±" required>
        </div>
        
        <div class="form-group">
            <label for="admin-password">ç®¡ç†å‘˜å¯†ç </label>
            <input type="password" id="admin-password" placeholder="è¾“å…¥ç®¡ç†å‘˜å¯†ç " required>
        </div>
        
        <button id="upload-btn">å¼€å§‹ä¸Šä¼ </button>
        
        <div class="progress" id="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill">0%</div>
            </div>
        </div>
        
        <div class="status" id="status"></div>
    </div>
    
    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="js/types.js"></script>
    <script src="js/default-emperors-data.js"></script>
    <script src="js/firebase-config.js"></script>
    <script>
        // åˆå§‹åŒ– Firebase
        initializeFirebase();
        
        const uploadBtn = document.getElementById('upload-btn');
        const emailInput = document.getElementById('admin-email');
        const passwordInput = document.getElementById('admin-password');
        const statusDiv = document.getElementById('status');
        const progressDiv = document.getElementById('progress');
        const progressFill = document.getElementById('progress-fill');
        
        uploadBtn.addEventListener('click', async () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!email || !password) {
                showStatus('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');
                return;
            }
            
            uploadBtn.disabled = true;
            uploadBtn.textContent = 'æ­£åœ¨ä¸Šä¼ ...';
            statusDiv.className = 'status';
            statusDiv.style.display = 'none';
            
            try {
                // 1. ç™»å½•
                showStatus('æ­£åœ¨ç™»å½•...', 'info');
                const auth = window.getFirebaseAuth();
                await auth.signInWithEmailAndPassword(email, password);
                showStatus('ç™»å½•æˆåŠŸï¼', 'success');
                
                // 2. è¯»å–é»˜è®¤çš‡å¸æ•°æ®
                showStatus('æ­£åœ¨è¯»å–çš‡å¸æ•°æ®...', 'info');
                const emperors = createDefaultEmperorsData();
                
                if (!emperors || emperors.length === 0) {
                    showStatus('æ— æ³•è¯»å–çš‡å¸æ•°æ®ï¼', 'error');
                    uploadBtn.disabled = false;
                    uploadBtn.textContent = 'å¼€å§‹ä¸Šä¼ ';
                    return;
                }
                
                showStatus(`æ‰¾åˆ° ${emperors.length} ä¸ªçš‡å¸æ•°æ®`, 'success');
                
                // 3. ä¸Šä¼ åˆ°äº‘ç«¯
                showStatus('æ­£åœ¨ä¸Šä¼ åˆ°äº‘ç«¯...', 'info');
                progressDiv.style.display = 'block';
                
                const database = window.getFirebaseDatabase();
                const updates = {};
                
                emperors.forEach((emperor, index) => {
                    // ä½¿ç”¨çš‡å¸çš„ id ä½œä¸ºé”®
                    updates[`emperors/${emperor.id}`] = emperor;
                    
                    // æ›´æ–°è¿›åº¦
                    const progress = Math.round(((index + 1) / emperors.length) * 100);
                    progressFill.style.width = progress + '%';
                    progressFill.textContent = progress + '%';
                });
                
                await database.ref().update(updates);
                
                // 4. å®Œæˆ
                showStatus(`âœ… æˆåŠŸä¸Šä¼  ${emperors.length} ä¸ªçš‡å¸æ•°æ®åˆ°äº‘ç«¯ï¼`, 'success');
                uploadBtn.textContent = 'ä¸Šä¼ å®Œæˆ';
                
                setTimeout(() => {
                    showStatus('ä½ ç°åœ¨å¯ä»¥å…³é—­è¿™ä¸ªé¡µé¢ï¼Œåœ¨ä»»ä½•è®¾å¤‡ä¸Šåˆ·æ–°æ¸¸æˆå³å¯çœ‹åˆ°æ•°æ®ï¼', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('ä¸Šä¼ å¤±è´¥:', error);
                showStatus('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'é‡è¯•ä¸Šä¼ ';
            }
        });
        
        function showStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }
    </script>
</body>
</html>
