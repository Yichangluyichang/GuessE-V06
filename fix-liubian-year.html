<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤åˆ˜è¾©åœ¨ä½å¹´ä»½</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        .emperor-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .emperor-info p {
            margin: 8px 0;
        }
        .emperor-info strong {
            color: #495057;
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ä¿®å¤åˆ˜è¾©åœ¨ä½å¹´ä»½å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·å¯ä»¥ç›´æ¥ä¿®æ”¹åˆ˜è¾©çš„åœ¨ä½ç»“æŸå¹´ä»½ä¸º189å¹´ï¼ˆä¸å¼€å§‹å¹´ä»½ç›¸åŒï¼‰</p>
        
        <div id="emperor-info" class="emperor-info" style="display: none;">
            <h3>å½“å‰æ•°æ®ï¼š</h3>
            <p><strong>çš‡å¸IDï¼š</strong><span id="current-id"></span></p>
            <p><strong>åå­—ï¼š</strong><span id="current-name"></span></p>
            <p><strong>åœ¨ä½å¼€å§‹ï¼š</strong><span id="current-start"></span></p>
            <p><strong>åœ¨ä½ç»“æŸï¼š</strong><span id="current-end"></span></p>
        </div>
        
        <button id="load-btn" onclick="loadEmperor()">1. åŠ è½½åˆ˜è¾©æ•°æ®</button>
        <button id="fix-btn" onclick="fixYear()" disabled>2. ä¿®æ”¹ç»“æŸå¹´ä»½ä¸º189</button>
        
        <div id="status" class="status"></div>
    </div>

    <script src="js/firebase-config.js"></script>
    <script>
        let emperorData = null;
        let database = null;

        // åˆå§‹åŒ–Firebase
        function initFirebase() {
            try {
                const success = initializeFirebase();
                if (!success) {
                    throw new Error('Firebaseåˆå§‹åŒ–å¤±è´¥');
                }
                database = window.getFirebaseDatabase();
                showStatus('Firebaseåˆå§‹åŒ–æˆåŠŸ', 'success');
                return true;
            } catch (error) {
                showStatus('Firebaseåˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                return false;
            }
        }

        // åŠ è½½åˆ˜è¾©æ•°æ®
        async function loadEmperor() {
            showStatus('æ­£åœ¨åŠ è½½åˆ˜è¾©æ•°æ®...', 'info');
            
            if (!database) {
                if (!initFirebase()) {
                    return;
                }
            }

            try {
                // åˆ˜è¾©çš„IDæ˜¯ ä¸œæ±‰_åˆ˜è¾©
                const snapshot = await database.ref('emperors/ä¸œæ±‰_åˆ˜è¾©').once('value');
                emperorData = snapshot.val();

                if (!emperorData) {
                    showStatus('æœªæ‰¾åˆ°åˆ˜è¾©çš„æ•°æ®', 'error');
                    return;
                }

                // æ˜¾ç¤ºå½“å‰æ•°æ®
                document.getElementById('current-id').textContent = emperorData.id;
                document.getElementById('current-name').textContent = emperorData.name;
                document.getElementById('current-start').textContent = emperorData.reignStart;
                document.getElementById('current-end').textContent = emperorData.reignEnd;
                document.getElementById('emperor-info').style.display = 'block';

                // å¯ç”¨ä¿®å¤æŒ‰é’®
                document.getElementById('fix-btn').disabled = false;
                
                showStatus('æˆåŠŸåŠ è½½åˆ˜è¾©æ•°æ®ï¼å½“å‰åœ¨ä½æ—¶é—´ï¼š' + emperorData.reignStart + '-' + emperorData.reignEnd, 'success');
            } catch (error) {
                showStatus('åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ä¿®å¤å¹´ä»½
        async function fixYear() {
            if (!emperorData) {
                showStatus('è¯·å…ˆåŠ è½½æ•°æ®', 'error');
                return;
            }

            showStatus('æ­£åœ¨ä¿®æ”¹å¹´ä»½...', 'info');

            try {
                // ä¿®æ”¹ç»“æŸå¹´ä»½ä¸º189
                emperorData.reignEnd = 189;

                // ä¿å­˜åˆ°Firebase
                await database.ref('emperors/ä¸œæ±‰_åˆ˜è¾©').set(emperorData);

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('current-end').textContent = emperorData.reignEnd;

                showStatus('âœ… æˆåŠŸï¼åˆ˜è¾©çš„åœ¨ä½ç»“æŸå¹´ä»½å·²ä¿®æ”¹ä¸º189å¹´', 'success');
                
                // ç¦ç”¨æŒ‰é’®é˜²æ­¢é‡å¤ç‚¹å‡»
                document.getElementById('fix-btn').disabled = true;
            } catch (error) {
                showStatus('ä¿®æ”¹å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–Firebase
        window.addEventListener('DOMContentLoaded', () => {
            initFirebase();
        });
    </script>
</body>
</html>
